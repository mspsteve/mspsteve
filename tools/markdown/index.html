<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>linux命令 | 陌上花开博客</title>
    <meta name="description" content="每天进步一点点">
    
    
    <link rel="preload" href="/assets/css/styles.4720fc85.css" as="style"><link rel="preload" href="/assets/js/app.4720fc85.js" as="script"><link rel="preload" href="/assets/js/58.8804a74c.js" as="script"><link rel="prefetch" href="/assets/js/20.1f81db7c.js"><link rel="prefetch" href="/assets/css/1.styles.5fc62c76.css"><link rel="prefetch" href="/assets/js/1.5fc62c76.js"><link rel="prefetch" href="/assets/css/2.styles.bc490884.css"><link rel="prefetch" href="/assets/js/2.bc490884.js"><link rel="prefetch" href="/assets/js/3.e2cedc59.js"><link rel="prefetch" href="/assets/js/4.c645c891.js"><link rel="prefetch" href="/assets/js/5.03266063.js"><link rel="prefetch" href="/assets/js/6.674566fd.js"><link rel="prefetch" href="/assets/js/7.bcea4b1b.js"><link rel="prefetch" href="/assets/js/8.34dec1f9.js"><link rel="prefetch" href="/assets/js/9.ee0b5a00.js"><link rel="prefetch" href="/assets/js/10.1a04f867.js"><link rel="prefetch" href="/assets/js/11.fd2d1907.js"><link rel="prefetch" href="/assets/js/12.ea6a496e.js"><link rel="prefetch" href="/assets/js/13.52d42115.js"><link rel="prefetch" href="/assets/js/14.631d0550.js"><link rel="prefetch" href="/assets/js/15.22fecd09.js"><link rel="prefetch" href="/assets/js/16.4acddf9c.js"><link rel="prefetch" href="/assets/js/17.b287c2b8.js"><link rel="prefetch" href="/assets/js/18.16fb90c4.js"><link rel="prefetch" href="/assets/js/19.6f8fe613.js"><link rel="prefetch" href="/assets/js/21.3cfbcd4b.js"><link rel="prefetch" href="/assets/js/22.638cab3a.js"><link rel="prefetch" href="/assets/js/23.ad82ee65.js"><link rel="prefetch" href="/assets/js/24.59b155e3.js"><link rel="prefetch" href="/assets/js/25.3b58bd6c.js"><link rel="prefetch" href="/assets/js/26.04269eb0.js"><link rel="prefetch" href="/assets/js/27.7d8f9cdd.js"><link rel="prefetch" href="/assets/js/28.481a177a.js"><link rel="prefetch" href="/assets/js/29.cafe6a2a.js"><link rel="prefetch" href="/assets/js/30.af49ec21.js"><link rel="prefetch" href="/assets/js/31.bdc1b88d.js"><link rel="prefetch" href="/assets/js/32.10e36c02.js"><link rel="prefetch" href="/assets/js/33.3be50ad2.js"><link rel="prefetch" href="/assets/js/34.7da30499.js"><link rel="prefetch" href="/assets/js/35.dca94238.js"><link rel="prefetch" href="/assets/js/36.0fcaa35c.js"><link rel="prefetch" href="/assets/js/37.0dfa6d70.js"><link rel="prefetch" href="/assets/js/38.79135398.js"><link rel="prefetch" href="/assets/js/39.45bb2efc.js"><link rel="prefetch" href="/assets/js/40.1ea6797b.js"><link rel="prefetch" href="/assets/js/41.67e0af51.js"><link rel="prefetch" href="/assets/js/42.75eeffda.js"><link rel="prefetch" href="/assets/js/43.1e1aadc2.js"><link rel="prefetch" href="/assets/js/44.ad2c4711.js"><link rel="prefetch" href="/assets/js/45.a95621f9.js"><link rel="prefetch" href="/assets/js/46.cd596d91.js"><link rel="prefetch" href="/assets/js/47.b1385fd9.js"><link rel="prefetch" href="/assets/js/48.fa0a2448.js"><link rel="prefetch" href="/assets/js/49.19b0e6f6.js"><link rel="prefetch" href="/assets/js/50.565e6599.js"><link rel="prefetch" href="/assets/js/51.e20b2bad.js"><link rel="prefetch" href="/assets/js/52.c921f9fe.js"><link rel="prefetch" href="/assets/js/53.880edf56.js"><link rel="prefetch" href="/assets/js/54.89bae591.js"><link rel="prefetch" href="/assets/js/55.7fb4aeb6.js"><link rel="prefetch" href="/assets/js/56.283a312a.js"><link rel="prefetch" href="/assets/js/57.eb061203.js">
    <link rel="stylesheet" href="/assets/css/styles.4720fc85.css"><link rel="stylesheet" href="/assets/css/1.styles.5fc62c76.css"><link rel="stylesheet" href="/assets/css/2.styles.bc490884.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">陌上花开博客</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">java</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/" class="nav-link">java</a></li><li class="dropdown-item"><!----> <a href="/jvm/theory/" class="nav-link">原理</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">中间件</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/rpc/" class="nav-link">rpc</a></li><li class="dropdown-item"><!----> <a href="/mysql/" class="nav-link">mysql</a></li><li class="dropdown-item"><!----> <a href="/redis/" class="nav-link">redis</a></li><li class="dropdown-item"><!----> <a href="/message/" class="nav-link">message</a></li><li class="dropdown-item"><!----> <a href="/nginx/" class="nav-link">nginx</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">AI</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ai/reco/" class="nav-link">集体智慧编程</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">日常积累</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/" class="nav-link router-link-active">命令</a></li><li class="dropdown-item"><!----> <a href="/date/" class="nav-link">日常</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">other</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/other/" class="nav-link">其他</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">面试</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/interview/" class="nav-link">面试</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/mspsteve/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">java</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/" class="nav-link">java</a></li><li class="dropdown-item"><!----> <a href="/jvm/theory/" class="nav-link">原理</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">中间件</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/rpc/" class="nav-link">rpc</a></li><li class="dropdown-item"><!----> <a href="/mysql/" class="nav-link">mysql</a></li><li class="dropdown-item"><!----> <a href="/redis/" class="nav-link">redis</a></li><li class="dropdown-item"><!----> <a href="/message/" class="nav-link">message</a></li><li class="dropdown-item"><!----> <a href="/nginx/" class="nav-link">nginx</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">AI</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ai/reco/" class="nav-link">集体智慧编程</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">日常积累</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/" class="nav-link router-link-active">命令</a></li><li class="dropdown-item"><!----> <a href="/date/" class="nav-link">日常</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">other</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/other/" class="nav-link">其他</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">面试</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/interview/" class="nav-link">面试</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/mspsteve/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading open"><span>常用命令</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/tools/" class="sidebar-link">目录</a></li><li><a href="/tools/hadoop/" class="sidebar-link">hadoop命令</a></li><li><a href="/tools/hive/" class="sidebar-link">hive命令</a></li><li><a href="/tools/linux/" class="sidebar-link">linux命令</a></li><li><a href="/tools/ant/" class="sidebar-link">ant命令</a></li><li><a href="/tools/markdown/" class="active sidebar-link">linux命令</a></li><li><a href="/tools/java/" class="sidebar-link">JVM常用命令整理</a></li><li><a href="/tools/charles/" class="sidebar-link">charles</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="linux命令"><a href="#linux命令" aria-hidden="true" class="header-anchor">#</a> linux命令</h1> <p></p><div class="table-of-contents"><ul><li><a href="#常用基础命令">常用基础命令</a><ul><li><a href="#crontab命令">crontab命令</a></li><li><a href="#crond用法">crond用法</a></li><li><a href="#awk命令">awk命令</a></li><li><a href="#cut命令">cut命令</a></li></ul></li><li><a href="#负载问题排查">负载问题排查</a><ul><li><a href="#基本概念">基本概念</a></li><li><a href="#排查问题思路">排查问题思路</a></li></ul></li></ul></div><p></p> <h2 id="常用基础命令"><a href="#常用基础命令" aria-hidden="true" class="header-anchor">#</a> 常用基础命令</h2> <h3 id="crontab命令"><a href="#crontab命令" aria-hidden="true" class="header-anchor">#</a> crontab命令</h3> <ul><li>crond linux循环运行的定时任务</li> <li>at命令为一次运行任务</li> <li>文件路径：/etc/crontab</li> <li>crond表达式格式:minute   hour   day   month   week   command</li> <li>crond日志重定向 ：0 */3 * * * /usr/local/apache2/apachectl restart &gt;/dev/null 2&gt;&amp;1</li> <li>crond用法</li></ul> <h3 id="crond用法"><a href="#crond用法" aria-hidden="true" class="header-anchor">#</a> crond用法</h3> <ul><li>crond服务</li></ul> <div class="language-powershell line-numbers-mode"><pre class="language-powershell"><code>service crond status <span class="token comment">#查看crontab服务状态</span>
service crond <span class="token function">start</span>  <span class="token comment">#手动启动crontab服务</span>
ntsysv <span class="token comment">#查看crontab服务是否已设置为开机启动，执行命令</span>
chkconfig –level 35 crond on <span class="token comment">#加入开机自动启动</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>crontab命令</li></ul> <div class="language-powershell line-numbers-mode"><pre class="language-powershell"><code>crontab <span class="token operator">-</span>l <span class="token comment">#列出crontab文件</span>
crontab <span class="token operator">-</span>e <span class="token comment">#编辑crontab文件，保存后自动运行</span>
crontab <span class="token operator">-</span>r <span class="token comment">#删除crontab文件</span>
crontab &lt;filename&gt; <span class="token comment">#恢复丢失文件</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="awk命令"><a href="#awk命令" aria-hidden="true" class="header-anchor">#</a> awk命令</h3> <h3 id="cut命令"><a href="#cut命令" aria-hidden="true" class="header-anchor">#</a> cut命令</h3> <h2 id="负载问题排查"><a href="#负载问题排查" aria-hidden="true" class="header-anchor">#</a> 负载问题排查</h2> <h3 id="基本概念"><a href="#基本概念" aria-hidden="true" class="header-anchor">#</a> 基本概念</h3> <p><strong>平均负载</strong>：在单位时间内，系统处于可执行状态和不可中断状态的平均进程数，也就是平均活跃进程数,实质上是指活跃进程数的指数衰减平均值。<br></p> <p><strong>可运行状态</strong>：是指正在使用CPU或者正在等待CPU的进程，也就是我们用ps命令时看到的，处于R状态的进程。<br></p> <p><strong>不可中断状态</strong>：是处于内核态关键流程中的进程，并且这些流程是不可以打断的，比如说常见的是等待硬件设备的I/O响应，也就是我们再ps命令中看到的D状态(<code>Uninterruptible Sleep</code>，也称为<code>Disk Sleep</code>)<br></p> <p><strong>平均活跃线程数</strong>：综合上面表述，平均活跃线程数正在使用CPU的进程，还包括等待CPU和等待I/O的进程。</p> <p><strong>CPU使用率</strong>：单位时间内CPU繁忙情况的统计，跟平均负载并不一定完全对应。CPU密集型进程，使用大量CPU会导致平均负载升高，此时能够通过平均负载体现;I/O密集型进程，等待I/O也会导致平均负载升高，此时CPU使用率不一定高。
大量等待CPU的进程调度也会导致平均负载升高，CPU使用率也比较高。</p> <p><strong>CPU上下文切换</strong>：将上一个任务的CPU寄存器和程序计数器的内容保存起来，然后将新任务的上下文的内容加载到CPU寄存器和程序计数器，然后跳转到程序计数器所指的新位置，运行新任务。系统调用过程中，会发生两次CPU上下文切换。</p> <h3 id="排查问题思路"><a href="#排查问题思路" aria-hidden="true" class="header-anchor">#</a> 排查问题思路</h3> <ul><li>使用uptime 或者top判断系统是否过载</li></ul> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>$ uptime
 15:39:25 up 197 days, 38 min, 11 users,  load average: 2.70, 3.34, 3.18
# 当前时间    运行天数           正在登陆用户数              1分钟  5分钟 15分钟负载
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>通过过去15分钟 -&gt; 5分钟 -&gt; 1分钟 负载的变化，说明系统负载在降低,
实际生产环境，当平均负载高于CPU数据70%，需要分析负载过高的原因</p></div> <ul><li>判断linux 系统cpu个数</li></ul> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>$ grep 'model name' /proc/cpuinfo | wc -l
56
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>使用mpstat 查询CPU使用率情况，判断是否为CPU密集型还是I/O密集型,或者是线程数据过多</li></ul> <div class="language-linux line-numbers-mode"><pre class="language-text"><code># -P ALL 表示监控所有 CPU，后面数字5表示间隔5s后输出一组数据
$ mpstat -P ALL 5
Linux 3.10.0-693.5.2.el7.x86_64 (bjfk-rs7369.yz02) 	2019年02月21日 	_x86_64_	(56 CPU)

15时47分11秒  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
15时47分15秒  all    5.12    0.02    0.68    0.02    0.00    0.01    0.00    0.00    0.00   94.15
15时47分15秒    0    3.98    0.00    1.33    0.00    0.00    0.00    0.00    0.00    0.00   94.69
15时47分15秒    1   30.71    0.00    0.52    0.00    0.00    0.00    0.00    0.00    0.00   68.77
15时47分15秒    2    4.18    0.26    1.04    0.00    0.00    0.00    0.00    0.00    0.00   94.52
15时47分15秒    3    0.52    0.00    0.26    0.00    0.00    0.00    0.00    0.00    0.00   99.21
15时47分15秒    4    6.07    0.00    1.06    0.26    0.00    0.00    0.00    0.00    0.00   92.61
15时47分15秒    5    0.52    0.00    0.26    0.00    0.00    0.00    0.00    0.00    0.00   99.21
15时47分15秒    6    4.44    0.00    1.04    0.00    0.00    0.00    0.00    0.00    0.00   94.52
15时47分15秒    7    0.26    0.00    0.26    0.00    0.00    0.00    0.00    0.00    0.00   99.48
15时47分15秒    8    2.62    0.00    0.52    0.26    0.00    0.00    0.00    0.00    0.00   96.60
15时47分15秒    9    0.52    0.00    0.26    0.00    0.00    0.00    0.00    0.00    0.00   99.21
15时47分15秒   10    2.88    0.26    0.52    0.00    0.00    0.00    0.00    0.00    0.00   96.34
……
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <ul><li>03:29:29 PM : 指mpstat运行的时间</li> <li>all : 指所有CPU</li> <li>%usr : 显示在用户级别（例如应用程序）执行时CPU利用率的百分比</li> <li>%nice :显示在拥有nice优先级的用户级别执行时CPU利用率的百分比</li> <li>%sys : 现实在系统级别（例如内核）执行时CPU利用率的百分比</li> <li>%iowait : 显示在系统有未完成的磁盘I/O请求期间CPU空闲时间的百分比</li> <li>%irq : 显示CPU服务硬件中断所花费时间的百分比</li> <li>%soft : 显示CPU服务软件中断所花费时间的百分比</li> <li>%steal : 显示虚拟机管理器在服务另一个虚拟处理器时虚拟CPU处在非自愿等待下花费时间的百分比</li> <li>%guest : 显示运行虚拟处理器时CPU花费时间的百分比</li> <li>%idle : 显示CPU空闲和系统没有未完成的磁盘I/O请求情况下的时间百分比</li></ul></div> <ul><li>I/O密集型或者线程数量过多，使用pidstat查询iowait，确认进程(针对I/O过多或者进程争抢过大的情况无法判断)</li></ul> <div class="language-linux line-numbers-mode"><pre class="language-text"><code># 间隔 5 秒后输出一组数据，-u 表示 CPU 指标
$ pidstat -u 5 1
Linux 4.15.0 (ubuntu)     09/22/18     _x86_64_    (2 CPU)
13:42:08      UID       PID    %usr %system  %guest   %wait    %CPU   CPU  Command
13:42:13        0       104    0.00    3.39    0.00    0.00    3.39     1  kworker/1:1H
13:42:13        0       109    0.00    0.40    0.00    0.00    0.40     0  kworker/0:1H
13:42:13        0      2997    2.00   35.53    0.00    3.99   37.52     1  stress
13:42:13        0      3057    0.00    0.40    0.00    0.00    0.40     0  pidstat

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>使用vmstat分析切换以及切换类型来判断I/O过多或者线程争抢过大</li></ul> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>vmstat 1
procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
 4  0      0 2783080 374944 13835420    0    0     3    54    0    0  7  1 92  0  0
 3  0      0 2783412 374944 13835420    0    0     0    96 92709 50615  6  1 93  0  0
 2  0      0 2784440 374944 13835520    0    0     0     0 52740 52105  5  1 95  0  0
 4  0      0 2785980 374944 13835484    0    0     0     0 53759 48080  5  1 95  0  0
 3  0      0 2784212 374944 13835996    0    0     0    16 59296 51606  5  0 94  0  0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <ul><li><strong>r</strong> 表示运行队列(就是说多少个进程真的分配到CPU)</li> <li><strong>b</strong> 表示阻塞的进程</li> <li>swpd 虚拟内存已使用的大小</li> <li>free 空闲物理内存</li> <li>buff Linux/Unix系统是用来存储缓存</li> <li>cache 缓存文件</li> <li>si  每秒从磁盘读入虚拟内存的大小</li> <li>so  每秒虚拟内存写入磁盘的大小</li> <li>bi  块设备每秒接收的块数量,默认大小1024byte</li> <li>bo  块设备每秒发送的块数量</li> <li><strong>in</strong>  每秒CPU的中断次数，包括时间中断</li> <li><strong>cs</strong>  每秒上下文切换次数</li> <li>us  用户CPU时间</li> <li>sy  系统CPU时间</li> <li>id  空闲CPU时间，一般来说，id + us + sy = 100</li></ul></div> <p>重点分析标记4列，判断是否为CPU频繁的上下文切换导致。</p> <ul><li><p>lsof（list open files）是一个查看当前系统文件的工具，也可以用于问题排查，具体见<a href="https://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/lsof.html" target="_blank" rel="noopener noreferrer">博客<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p>top、uptime等命令只能查询出来长时间进程，短时间进程可使用perf命令查询，可以统计某个时间段内数据，使用pstree可以查询子进程</p></li></ul> <div class="language-linux line-numbers-mode"><pre class="language-text"><code># 记录性能事件，等待大约 15 秒后按 Ctrl+C 退出
$ perf record -g

# 查看报告
$ perf report

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">2/21/2019, 6:04:46 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/tools/ant/" class="prev">
          ant命令
        </a></span> <span class="next"><a href="/tools/java/">
          JVM常用命令整理
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/58.8804a74c.js" defer></script><script src="/assets/js/app.4720fc85.js" defer></script>
  </body>
</html>
