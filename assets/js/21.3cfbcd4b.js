(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{220:function(a,s,t){"use strict";t.r(s);var n=t(0),e=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("div",{staticClass:"content"},[t("h1",{attrs:{id:"unsafe"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#unsafe","aria-hidden":"true"}},[a._v("#")]),a._v(" unsafe")]),a._v(" "),t("p"),t("div",{staticClass:"table-of-contents"},[t("ul",[t("li",[t("a",{attrs:{href:"#通过unsafe类可以分配内存，可以释放内存"}},[a._v("通过Unsafe类可以分配内存，可以释放内存")])]),t("li",[t("a",{attrs:{href:"#偏移量的获取"}},[a._v("偏移量的获取")])]),t("li",[t("a",{attrs:{href:"#挂起与恢复"}},[a._v("挂起与恢复")])]),t("li",[t("a",{attrs:{href:"#cas操作"}},[a._v("CAS操作")])])])]),t("p"),a._v(" "),t("h2",{attrs:{id:"通过unsafe类可以分配内存，可以释放内存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#通过unsafe类可以分配内存，可以释放内存","aria-hidden":"true"}},[a._v("#")]),a._v(" 通过Unsafe类可以分配内存，可以释放内存")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[a._v("   方法如下：\n   "),t("span",{attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{attrs:{class:"token keyword"}},[a._v("native")]),a._v(" "),t("span",{attrs:{class:"token keyword"}},[a._v("long")]),a._v(" "),t("span",{attrs:{class:"token function"}},[a._v("allocateMemory")]),t("span",{attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{attrs:{class:"token keyword"}},[a._v("long")]),a._v(" l"),t("span",{attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n   "),t("span",{attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{attrs:{class:"token keyword"}},[a._v("native")]),a._v(" "),t("span",{attrs:{class:"token keyword"}},[a._v("long")]),a._v(" "),t("span",{attrs:{class:"token function"}},[a._v("reallocateMemory")]),t("span",{attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{attrs:{class:"token keyword"}},[a._v("long")]),a._v(" l"),t("span",{attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{attrs:{class:"token keyword"}},[a._v("long")]),a._v(" l1"),t("span",{attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n   "),t("span",{attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{attrs:{class:"token keyword"}},[a._v("native")]),a._v(" "),t("span",{attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),t("span",{attrs:{class:"token function"}},[a._v("freeMemory")]),t("span",{attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{attrs:{class:"token keyword"}},[a._v("long")]),a._v(" l"),t("span",{attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br")])]),t("h2",{attrs:{id:"偏移量的获取"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#偏移量的获取","aria-hidden":"true"}},[a._v("#")]),a._v(" 偏移量的获取")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("字段的定位：JAVA 对象定位staticFieldOffset方法实现，该方法返回给定field的内存地址偏移量，这个值对于给定的filed是唯一的且是固定不变的。")]),a._v(" "),t("ul",[t("li",[a._v("getIntVolatile方法获取对象中offset偏移地址对应的整型field的值,支持volatile load语义。")]),a._v(" "),t("li",[a._v("getLong方法获取对象中offset偏移地址对应的long型field的值。")])])]),a._v(" "),t("li",[t("p",[a._v("数组元素定位：")]),a._v(" "),t("ul",[t("li",[a._v("Unsafe类中有很多以BASE_OFFSET结尾的常量，比如ARRAY_INT_BASE_OFFSET，ARRAY_BYTE_BASE_OFFSET等，这些常量值是通过arrayBaseOffset方法得到的。")])]),a._v(" "),t("blockquote",[t("p",[a._v("arrayBaseOffset方法是一个本地方法，可以获取数组第一个元素的偏移地址。")])]),a._v(" "),t("ul",[t("li",[a._v("Unsafe类中还有很多以INDEX_SCALE结尾的常量，比如 ARRAY_INT_INDEX_SCALE ， ARRAY_BYTE_INDEX_SCALE等，这些常量值是通过arrayIndexScale方法得到的。")])]),a._v(" "),t("blockquote",[t("p",[a._v("arrayIndexScale方法也是一个本地方法，可以获取数组的转换因子，也就是数组中元素的增量地址。")])]),a._v(" "),t("blockquote",[t("p",[a._v("将arrayBaseOffset与arrayIndexScale配合使用，可以定位数组中每个元素在内存中的位置。")])])])]),a._v(" "),t("h2",{attrs:{id:"挂起与恢复"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#挂起与恢复","aria-hidden":"true"}},[a._v("#")]),a._v(" 挂起与恢复")]),a._v(" "),t("ul",[t("li",[a._v("park方法：线程挂起，当中断或者超时时停止；")]),a._v(" "),t("li",[a._v("unpark方法：终止线程挂起，恢复正常；")])]),a._v(" "),t("h2",{attrs:{id:"cas操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cas操作","aria-hidden":"true"}},[a._v("#")]),a._v(" CAS操作")]),a._v(" "),t("p",[a._v("obj 对象偏移offset的（int属性）Filed值与期望值是否相等，若相等，则更新")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{attrs:{class:"token comment"}},[a._v("/**\n* 比较obj的offset处内存位置中的值和期望的值，如果相同则更新。此更新是不可中断的。\n*\n* @param obj 需要更新的对象\n* @param offset obj中整型field的偏移量\n* @param expect 希望field中存在的值\n* @param update 如果期望值expect与field的当前值相同，设置filed的值为这个新值\n* @return 如果field的值被更改返回true\n*/")]),a._v("\n"),t("span",{attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{attrs:{class:"token keyword"}},[a._v("native")]),a._v(" "),t("span",{attrs:{class:"token keyword"}},[a._v("boolean")]),a._v(" "),t("span",{attrs:{class:"token function"}},[a._v("compareAndSwapInt")]),t("span",{attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Object obj"),t("span",{attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{attrs:{class:"token keyword"}},[a._v("long")]),a._v(" offset"),t("span",{attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{attrs:{class:"token keyword"}},[a._v("int")]),a._v(" expect"),t("span",{attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{attrs:{class:"token keyword"}},[a._v("int")]),a._v(" update"),t("span",{attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br")])])])}],!1,null,null,null);e.options.__file="README.md";s.default=e.exports}}]);