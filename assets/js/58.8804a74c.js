(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{201:function(t,s,e){"use strict";e.r(s);var n=e(0),a=Object(n.a)({},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"content"},[t._m(0),t._v(" "),e("p"),t._m(1),e("p"),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),t._m(8),t._v(" "),t._m(9),t._m(10),t._v(" "),t._m(11),t._v(" "),t._m(12),t._v(" "),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15),t._v(" "),t._m(16),t._v(" "),t._m(17),t._v(" "),t._m(18),t._v(" "),t._m(19),t._v(" "),t._m(20),t._v(" "),t._m(21),t._v(" "),t._m(22),t._m(23),t._v(" "),t._m(24),t._v(" "),t._m(25),t._m(26),t._v(" "),t._m(27),t._m(28),t._v(" "),t._m(29),t._v(" "),t._m(30),t._m(31),t._v(" "),t._m(32),t._m(33),t._v(" "),e("p",[t._v("重点分析标记4列，判断是否为CPU频繁的上下文切换导致。")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("lsof（list open files）是一个查看当前系统文件的工具，也可以用于问题排查，具体见"),e("a",{attrs:{href:"https://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/lsof.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("博客"),e("OutboundLink")],1)])]),t._v(" "),t._m(34)]),t._v(" "),t._m(35)])},[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"linux命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#linux命令","aria-hidden":"true"}},[this._v("#")]),this._v(" linux命令")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"table-of-contents"},[e("ul",[e("li",[e("a",{attrs:{href:"#常用基础命令"}},[t._v("常用基础命令")]),e("ul",[e("li",[e("a",{attrs:{href:"#crontab命令"}},[t._v("crontab命令")])]),e("li",[e("a",{attrs:{href:"#crond用法"}},[t._v("crond用法")])]),e("li",[e("a",{attrs:{href:"#awk命令"}},[t._v("awk命令")])]),e("li",[e("a",{attrs:{href:"#cut命令"}},[t._v("cut命令")])])])]),e("li",[e("a",{attrs:{href:"#负载问题排查"}},[t._v("负载问题排查")]),e("ul",[e("li",[e("a",{attrs:{href:"#基本概念"}},[t._v("基本概念")])]),e("li",[e("a",{attrs:{href:"#排查问题思路"}},[t._v("排查问题思路")])])])])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"常用基础命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常用基础命令","aria-hidden":"true"}},[this._v("#")]),this._v(" 常用基础命令")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"crontab命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#crontab命令","aria-hidden":"true"}},[this._v("#")]),this._v(" crontab命令")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ul",[e("li",[t._v("crond linux循环运行的定时任务")]),t._v(" "),e("li",[t._v("at命令为一次运行任务")]),t._v(" "),e("li",[t._v("文件路径：/etc/crontab")]),t._v(" "),e("li",[t._v("crond表达式格式:minute   hour   day   month   week   command")]),t._v(" "),e("li",[t._v("crond日志重定向 ：0 */3 * * * /usr/local/apache2/apachectl restart >/dev/null 2>&1")]),t._v(" "),e("li",[t._v("crond用法")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"crond用法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#crond用法","aria-hidden":"true"}},[this._v("#")]),this._v(" crond用法")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("crond服务")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-powershell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[t._v("service crond status "),e("span",{attrs:{class:"token comment"}},[t._v("#查看crontab服务状态")]),t._v("\nservice crond "),e("span",{attrs:{class:"token function"}},[t._v("start")]),t._v("  "),e("span",{attrs:{class:"token comment"}},[t._v("#手动启动crontab服务")]),t._v("\nntsysv "),e("span",{attrs:{class:"token comment"}},[t._v("#查看crontab服务是否已设置为开机启动，执行命令")]),t._v("\nchkconfig –level 35 crond on "),e("span",{attrs:{class:"token comment"}},[t._v("#加入开机自动启动")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("crontab命令")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-powershell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[t._v("crontab "),e("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("l "),e("span",{attrs:{class:"token comment"}},[t._v("#列出crontab文件")]),t._v("\ncrontab "),e("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("e "),e("span",{attrs:{class:"token comment"}},[t._v("#编辑crontab文件，保存后自动运行")]),t._v("\ncrontab "),e("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("r "),e("span",{attrs:{class:"token comment"}},[t._v("#删除crontab文件")]),t._v("\ncrontab <filename> "),e("span",{attrs:{class:"token comment"}},[t._v("#恢复丢失文件")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"awk命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#awk命令","aria-hidden":"true"}},[this._v("#")]),this._v(" awk命令")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"cut命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cut命令","aria-hidden":"true"}},[this._v("#")]),this._v(" cut命令")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"负载问题排查"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#负载问题排查","aria-hidden":"true"}},[this._v("#")]),this._v(" 负载问题排查")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"基本概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基本概念","aria-hidden":"true"}},[this._v("#")]),this._v(" 基本概念")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("平均负载")]),this._v("：在单位时间内，系统处于可执行状态和不可中断状态的平均进程数，也就是平均活跃进程数,实质上是指活跃进程数的指数衰减平均值。"),s("br")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("可运行状态")]),this._v("：是指正在使用CPU或者正在等待CPU的进程，也就是我们用ps命令时看到的，处于R状态的进程。"),s("br")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("不可中断状态")]),this._v("：是处于内核态关键流程中的进程，并且这些流程是不可以打断的，比如说常见的是等待硬件设备的I/O响应，也就是我们再ps命令中看到的D状态("),s("code",[this._v("Uninterruptible Sleep")]),this._v("，也称为"),s("code",[this._v("Disk Sleep")]),this._v(")"),s("br")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("平均活跃线程数")]),this._v("：综合上面表述，平均活跃线程数正在使用CPU的进程，还包括等待CPU和等待I/O的进程。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("CPU使用率")]),this._v("：单位时间内CPU繁忙情况的统计，跟平均负载并不一定完全对应。CPU密集型进程，使用大量CPU会导致平均负载升高，此时能够通过平均负载体现;I/O密集型进程，等待I/O也会导致平均负载升高，此时CPU使用率不一定高。\n大量等待CPU的进程调度也会导致平均负载升高，CPU使用率也比较高。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("CPU上下文切换")]),this._v("：将上一个任务的CPU寄存器和程序计数器的内容保存起来，然后将新任务的上下文的内容加载到CPU寄存器和程序计数器，然后跳转到程序计数器所指的新位置，运行新任务。系统调用过程中，会发生两次CPU上下文切换。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"排查问题思路"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#排查问题思路","aria-hidden":"true"}},[this._v("#")]),this._v(" 排查问题思路")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("使用uptime 或者top判断系统是否过载")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-linux line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("$ uptime\n 15:39:25 up 197 days, 38 min, 11 users,  load average: 2.70, 3.34, 3.18\n# 当前时间    运行天数           正在登陆用户数              1分钟  5分钟 15分钟负载\n")])]),this._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[this._v("1")]),s("br"),s("span",{staticClass:"line-number"},[this._v("2")]),s("br"),s("span",{staticClass:"line-number"},[this._v("3")]),s("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[this._v("TIP")]),this._v(" "),s("p",[this._v("通过过去15分钟 -> 5分钟 -> 1分钟 负载的变化，说明系统负载在降低,\n实际生产环境，当平均负载高于CPU数据70%，需要分析负载过高的原因")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("判断linux 系统cpu个数")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-linux line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("$ grep 'model name' /proc/cpuinfo | wc -l\n56\n")])]),this._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[this._v("1")]),s("br"),s("span",{staticClass:"line-number"},[this._v("2")]),s("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("使用mpstat 查询CPU使用率情况，判断是否为CPU密集型还是I/O密集型,或者是线程数据过多")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-linux line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("# -P ALL 表示监控所有 CPU，后面数字5表示间隔5s后输出一组数据\n$ mpstat -P ALL 5\nLinux 3.10.0-693.5.2.el7.x86_64 (bjfk-rs7369.yz02) \t2019年02月21日 \t_x86_64_\t(56 CPU)\n\n15时47分11秒  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle\n15时47分15秒  all    5.12    0.02    0.68    0.02    0.00    0.01    0.00    0.00    0.00   94.15\n15时47分15秒    0    3.98    0.00    1.33    0.00    0.00    0.00    0.00    0.00    0.00   94.69\n15时47分15秒    1   30.71    0.00    0.52    0.00    0.00    0.00    0.00    0.00    0.00   68.77\n15时47分15秒    2    4.18    0.26    1.04    0.00    0.00    0.00    0.00    0.00    0.00   94.52\n15时47分15秒    3    0.52    0.00    0.26    0.00    0.00    0.00    0.00    0.00    0.00   99.21\n15时47分15秒    4    6.07    0.00    1.06    0.26    0.00    0.00    0.00    0.00    0.00   92.61\n15时47分15秒    5    0.52    0.00    0.26    0.00    0.00    0.00    0.00    0.00    0.00   99.21\n15时47分15秒    6    4.44    0.00    1.04    0.00    0.00    0.00    0.00    0.00    0.00   94.52\n15时47分15秒    7    0.26    0.00    0.26    0.00    0.00    0.00    0.00    0.00    0.00   99.48\n15时47分15秒    8    2.62    0.00    0.52    0.26    0.00    0.00    0.00    0.00    0.00   96.60\n15时47分15秒    9    0.52    0.00    0.26    0.00    0.00    0.00    0.00    0.00    0.00   99.21\n15时47分15秒   10    2.88    0.26    0.52    0.00    0.00    0.00    0.00    0.00    0.00   96.34\n……\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br"),e("span",{staticClass:"line-number"},[t._v("14")]),e("br"),e("span",{staticClass:"line-number"},[t._v("15")]),e("br"),e("span",{staticClass:"line-number"},[t._v("16")]),e("br"),e("span",{staticClass:"line-number"},[t._v("17")]),e("br"),e("span",{staticClass:"line-number"},[t._v("18")]),e("br")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"tip custom-block"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("ul",[e("li",[t._v("03:29:29 PM : 指mpstat运行的时间")]),t._v(" "),e("li",[t._v("all : 指所有CPU")]),t._v(" "),e("li",[t._v("%usr : 显示在用户级别（例如应用程序）执行时CPU利用率的百分比")]),t._v(" "),e("li",[t._v("%nice :显示在拥有nice优先级的用户级别执行时CPU利用率的百分比")]),t._v(" "),e("li",[t._v("%sys : 现实在系统级别（例如内核）执行时CPU利用率的百分比")]),t._v(" "),e("li",[t._v("%iowait : 显示在系统有未完成的磁盘I/O请求期间CPU空闲时间的百分比")]),t._v(" "),e("li",[t._v("%irq : 显示CPU服务硬件中断所花费时间的百分比")]),t._v(" "),e("li",[t._v("%soft : 显示CPU服务软件中断所花费时间的百分比")]),t._v(" "),e("li",[t._v("%steal : 显示虚拟机管理器在服务另一个虚拟处理器时虚拟CPU处在非自愿等待下花费时间的百分比")]),t._v(" "),e("li",[t._v("%guest : 显示运行虚拟处理器时CPU花费时间的百分比")]),t._v(" "),e("li",[t._v("%idle : 显示CPU空闲和系统没有未完成的磁盘I/O请求情况下的时间百分比")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("I/O密集型或者线程数量过多，使用pidstat查询iowait，确认进程(针对I/O过多或者进程争抢过大的情况无法判断)")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-linux line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("# 间隔 5 秒后输出一组数据，-u 表示 CPU 指标\n$ pidstat -u 5 1\nLinux 4.15.0 (ubuntu)     09/22/18     _x86_64_    (2 CPU)\n13:42:08      UID       PID    %usr %system  %guest   %wait    %CPU   CPU  Command\n13:42:13        0       104    0.00    3.39    0.00    0.00    3.39     1  kworker/1:1H\n13:42:13        0       109    0.00    0.40    0.00    0.00    0.40     0  kworker/0:1H\n13:42:13        0      2997    2.00   35.53    0.00    3.99   37.52     1  stress\n13:42:13        0      3057    0.00    0.40    0.00    0.00    0.40     0  pidstat\n\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("使用vmstat分析切换以及切换类型来判断I/O过多或者线程争抢过大")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-linux line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("vmstat 1\nprocs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----\n r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st\n 4  0      0 2783080 374944 13835420    0    0     3    54    0    0  7  1 92  0  0\n 3  0      0 2783412 374944 13835420    0    0     0    96 92709 50615  6  1 93  0  0\n 2  0      0 2784440 374944 13835520    0    0     0     0 52740 52105  5  1 95  0  0\n 4  0      0 2785980 374944 13835484    0    0     0     0 53759 48080  5  1 95  0  0\n 3  0      0 2784212 374944 13835996    0    0     0    16 59296 51606  5  0 94  0  0\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"tip custom-block"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("ul",[e("li",[e("strong",[t._v("r")]),t._v(" 表示运行队列(就是说多少个进程真的分配到CPU)")]),t._v(" "),e("li",[e("strong",[t._v("b")]),t._v(" 表示阻塞的进程")]),t._v(" "),e("li",[t._v("swpd 虚拟内存已使用的大小")]),t._v(" "),e("li",[t._v("free 空闲物理内存")]),t._v(" "),e("li",[t._v("buff Linux/Unix系统是用来存储缓存")]),t._v(" "),e("li",[t._v("cache 缓存文件")]),t._v(" "),e("li",[t._v("si  每秒从磁盘读入虚拟内存的大小")]),t._v(" "),e("li",[t._v("so  每秒虚拟内存写入磁盘的大小")]),t._v(" "),e("li",[t._v("bi  块设备每秒接收的块数量,默认大小1024byte")]),t._v(" "),e("li",[t._v("bo  块设备每秒发送的块数量")]),t._v(" "),e("li",[e("strong",[t._v("in")]),t._v("  每秒CPU的中断次数，包括时间中断")]),t._v(" "),e("li",[e("strong",[t._v("cs")]),t._v("  每秒上下文切换次数")]),t._v(" "),e("li",[t._v("us  用户CPU时间")]),t._v(" "),e("li",[t._v("sy  系统CPU时间")]),t._v(" "),e("li",[t._v("id  空闲CPU时间，一般来说，id + us + sy = 100")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("li",[s("p",[this._v("top、uptime等命令只能查询出来长时间进程，短时间进程可使用perf命令查询，可以统计某个时间段内数据，使用pstree可以查询子进程")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-linux line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("# 记录性能事件，等待大约 15 秒后按 Ctrl+C 退出\n$ perf record -g\n\n# 查看报告\n$ perf report\n\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br")])])}],!1,null,null,null);a.options.__file="README.md";s.default=a.exports}}]);